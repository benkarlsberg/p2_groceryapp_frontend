<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <title>Test HTML</title>
  </head>
  <body>
    <h1>This is a test page</h1>
    <button onclick="getCartItem()">Get Cart Item</button>
    <span id="j"></span>

    <span id="c"></span>
    <span id= "h"></span>

    <!-- <table
      class="table table-bordered table-striped table-hover"
      style="width: 50%"
    >
    <thead>
      <th scope="col">Item</th>
      <th scope="col">price</th>
    </thead>
    <tbody>
      <tr>
        <td>Test item</td>
        <td>12</td>

      </tr>
      <tr>
        <td>Test item 2</td>
      </tr>
      <tr>
        <td>Name</td>
        <td>23</td>
      </tr>
    </tbody>
    </table> -->
    <button type="button" class="btn btn-dark" onclick="getAllCartItems()">
      Get all items
    </button>
    <br /><br />
    <span id="t"></span>
  </body>

  <script>
    async function getCartItem() {
      const httpResponse = await fetch("http://localhost:8080/cartitem");
      const body = await httpResponse.json();
      let elements = [];
      let items = [];

      var myCart =
          '<table class="table table-bordered table-striped table-hover" style="width: 50%;"> <thead> <th scope="col">Item</th> <th scope="col">Price</th> </thead>';
        var myHistory =
        '<table class="table table-bordered table-striped table-hover" style="width: 50%;"> <thead> <th scope="col">Item</th> <th scope="col">Date</th> </thead>';


      for (let i = 0; i <= body.length; i++) {
        let cartDate = JSON.stringify(body[i], ["cartHistory", "date"]);
        cartDate = cartDate.replace(/"cartHistory":/g, "");
        cartDate = cartDate.replace(/"date":/g, "");
        cartDate = cartDate.replace(/[{}, ""]/g, "");

        let item = JSON.stringify(body[i], ["item", "item_name"]);
        item = item.replace(/"item":/g, "");
        item = item.replace(/"item_name":/g, "");
        item = item.replace(/[{}, ""]/g, "");


        if (cartDate == 0 || cartDate == null) {
          myCart +=
            "<tr> <td>" +
            item +
            "</td><td>" +
            "price will go here" +
            "</td> </tr>";
          document.getElementById("c").innerHTML = myCart;
          // document.getElementById("j").innerHTML +=
          //   item + " is in your cart" + "<br>";
        } else {

          myHistory +=
            "<tr> <td>" +
            item +
            "</td><td>" +
            cartDate +
            "</td> </tr>";
            document.getElementById("h").innerHTML = myHistory;

          // document.getElementById("j").innerHTML +=
          //   item + " was purchased on " + cartDate + "<br>";
        }

      }
      // document.getElementById("c").innerHTML += myCart;
      // document.getElementById("c").innerHTML += "</table>";
    }

    // console.log(body)
    // extract(body);
    // elements.push(cartItem);
    // console.log(elements)
    // document.getElementById("j").innerHTML += cartItem;

    // document.getElementById("c").innerHTML += myCart;
    //   document.getElementById("c").innerHTML += "</table>";
    //   document.getElementById("h").innerHTML += myHistory;
    //   document.getElementById("h").innerHTML += "</table>";
    //   for(let i = 0; i <=body.length; i++){
    //     let cartDate = JSON.stringify(body[i], ["cartHistory", "date"]);
    //     cartDate = cartDate.replace(/"cartHistory":/g, "");
    //     cartDate = cartDate.replace(/"date":/g, "");
    //     cartDate = cartDate.replace(/[{}, ""]/g, "");
    //     let myCart =
    //     '<table class="table table-bordered table-striped table-hover" style="width: 50%;"> <thead> <th scope="col">Item</th> <th scope="col">Date</th> </thead>';
    //     let myHistory =
    //     '<table class="table table-bordered table-striped table-hover" style="width: 50%;"> <thead> <th scope="col">Item</th> <th scope="col">Price</th> </thead>';

    //     let item = JSON.stringify(body[i], ["item", "item_name"]);
    //     item = item.replace(/"item":/g, "");
    //     item = item.replace(/"item_name":/g, "");
    //     item = item.replace(/[{}, ""]/g, "");
    //     if(cartDate == 0 || cartDate == null){
    //       myCart +=
    //       "<tr> <td>" +
    //       item +
    //       "</td><td>" +
    //       "price will go here" +
    //       "</td> </tr>";
    //     }
    //     else {
    //       myHistory +=
    //       "<tr> <td>" +
    //       item +
    //       "</td><td>" +
    //       cartDate +
    //       "</td> </tr>";
    //     }
    //   }

    //   document.getElementById("c").innerHTML += myCart;
    //   document.getElementById("c").innerHTML += "</table>";
    //   document.getElementById("h").innerHTML += myHistory;
    //   document.getElementById("h").innerHTML += "</table>";

    async function getAllCartItems() {
      document.getElementById("t").innerHTML = "";
      let elementName = [];
      let elementPrice = [];
      // let num = 4;
      let id = 4;
      let myTable =
        '<table class="table table-bordered table-striped table-hover" style="width: 50%;"> <thead> <th scope="col">Item</th> <th scope="col">price</th> </thead>';

      for (let i = 0; i <= id; i++) {
        const url = `http://localhost:8080/item/${i + 1}`;
        const httpResponse = await fetch(url);
        const body = await httpResponse.json();

        console.log(i);
        // console.log(body);
        newBodyName = JSON.stringify(body, ["item_name"]);
        // console.log(newBodyName);

        newBodyName = newBodyName.replace(/"item_name":/g, "");
        newBodyName = newBodyName.replace(/[{}, ""]/g, "");
        newBodyPrice = JSON.stringify(body, ["price"]);
        newBodyPrice = newBodyPrice.replace(/"price":/g, "");
        newBodyPrice = newBodyPrice.replace(/[{}, ""]/g, "");

        elementName.push(newBodyName);
        elementPrice.push(newBodyPrice);

        myTable +=
          "<tr> <td>" +
          elementName[i] +
          "</td><td>" +
          "$" +
          elementPrice[i] +
          "</td> </tr>";
      }
      document.getElementById("t").innerHTML += myTable;
      document.getElementById("t").innerHTML += "</table>";

      // document.getElementById("t").innerHTML = myTable;
    }

    function extract(body) {
      document.getElementById("date").innerHTML = body.date;
    }
  </script>
</html>
